<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>座標テスト [v-test]</title>
    <style>
        body, html { margin: 0; padding: 0; overflow: hidden; height: 100%; width: 100%; background-color: #333; }
        #wrapper { position: fixed; top: 48px; left: 52px; right: 0; bottom: 0; padding: 20px; }
        canvas { display: block; width: 100%; height: 100%; background-color: #f0f0f0; }
        #debug { position: fixed; bottom: 10px; left: 10px; background: black; color: white; padding: 10px; font-family: monospace; border-radius: 4px; z-index: 99; }
    </style>
</head>
<body>

    <div id="wrapper">
        <canvas id="test-canvas"></canvas>
    </div>
    <div id="debug">キャンバスをクリックまたはタップしてください</div>

    <script>
        const canvas = document.getElementById('test-canvas');
        const ctx = canvas.getContext('2d');
        const debug = document.getElementById('debug');
        const dpr = window.devicePixelRatio || 1;

        // キャンバスのサイズ設定と高解像度対応
        function setupCanvas() {
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.scale(dpr, dpr);
        }

        // 画面上の座標をキャンバス内の座標に変換する
        function getCanvasCoordinates(event) {
            const rect = canvas.getBoundingClientRect();
            return {
                x: event.clientX - rect.left,
                y: event.clientY - rect.top,
            };
        }

        // 指定された座標に赤い丸を描画する
        function drawCircle(point) {
            // 一旦キャンバスをクリア
            ctx.clearRect(0, 0, canvas.width / dpr, canvas.height / dpr);

            // 丸を描画
            ctx.beginPath();
            ctx.arc(point.x, point.y, 10, 0, 2 * Math.PI); // 半径10pxの丸
            ctx.fillStyle = 'red';
            ctx.fill();
            
            // デバッグ情報を更新
            const rect = canvas.getBoundingClientRect();
            debug.innerHTML = 
                `クリック位置 (clientX): ${event.clientX.toFixed(1)}<br>` +
                `キャンバス左端 (rect.left): ${rect.left.toFixed(1)}<br>` +
                `計算後の座標 (calcX): ${point.x.toFixed(1)}`;
        }
        
        // イベントリスナー
        canvas.addEventListener('pointerdown', (event) => {
            const coords = getCanvasCoordinates(event);
            drawCircle(coords);
        });

        // 初期化
        window.addEventListener('resize', setupCanvas);
        setupCanvas();
    </script>
</body>
</html>
